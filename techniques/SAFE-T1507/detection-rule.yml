title: MCP OAuth Authorization Code Interception Detection
id: 2aa0f9c2-f9b0-4b20-96e8-e2325f215491
status: experimental
description: Detects potential authorization code interception through duplicate token exchange attempts
author: SAFE-MCP Team
date: 2025-01-20
references:
  - https://github.com/safe-mcp/techniques/SAFE-T1507
  - https://tools.ietf.org/html/rfc7636
logsource:
  product: mcp
  service: oauth_token_exchange
detection:
  selection_duplicate_code:
    authorization_code|count|gt: 1
    timeframe: 5s
    different_client_id: true
  selection_race_condition:
    token_exchange_timestamp:
      - '|difference|lt: 1s'
    same_authorization_code: true
    different_source_ip: true
  selection_code_in_referrer:
    http_referrer|contains:
      - '*code=*'
      - '*authorization_code=*'
    http_referrer|not|contains:
      - 'oauth.example.com'
  condition: selection_duplicate_code or selection_race_condition or selection_code_in_referrer
falsepositives:
  - Legitimate retry attempts with same authorization code
  - Load-balanced token endpoints with different source IPs
  - Development/testing environments
level: high
tags:
  - attack.credential_access
  - attack.t1550
  - safe.t1507

